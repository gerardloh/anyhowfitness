<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/register.css">
    <!-- <script src="js/register.js" defer></script> -->
    <title>Registration Form</title>

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" 
    rel="stylesheet" 
    integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" 
    crossorigin="anonymous">
    <style>
       .progress-step {
        text-align: center;
       }
       #next {
        margin-top: 7%;
       }
       #problems, #error-header {
        color: red;
       }
    </style>
</head>
<body>
    <div class="alert" style="display: none;">
        This is an alert message.
    </div>
    <form action="forum.html" class="form container" id="registrationForm">
        <!-- Progress bar -->
     
        <div class="progressbar" >
            <div class="progress " id="progress"></div>
            <div class="progress-step progress-step-active" data-title="Registration"></div>
            <div class="progress-step" data-title="Your details"></div>
            <div class="progress-step" data-title="Health History"></div>
            <div class="progress-step" data-title="Lifestyle & Nutrition"></div>
        </div>
   
        <!-- Steps -->
        <div class="form-step form-step-active" data-step="1">
            <!-- Step 1 Fields -->
            <h1 class="display mb-3">Register with us!</h1>
            <div class="row input-group">
                <div class="col-sm-12 form-group">
                    <label for="name"><strong>Full name:*</strong></label>
                    <input id="name" type="text" class="form-control" aria-describedby="nameHelp" placeholder="Full Name">
                </div>
            </div>
            <div class="row input-group">
                <div class="col-sm-12 col-lg-12 col-md-12 form-group">
                    <label for="emailId"><strong>Email address:*</strong></label>
                    <input id="emailId" type="email" class="form-control" placeholder="johndoe.2022@scis.smu.edu.sg">
                </div>
            </div>
            <div class="row input-group">
                <div class="col form-group">
                    <label for="birthdate"><strong>Date of Birth:*</strong></label>
                    <input id="birthdate" class="form-control" type="date" placeholder="Enter birth date" style="height:38px;">
                </div>
                <div class="col form-group">
                    <label for="phoneNumber"><strong>Phone Number:*</strong></label>
                    <input id="phoneNumber" type="text" class="form-control" placeholder="+65 9123 4567">
                </div>
            </div>

            <div class="row input-group">
                <div class="col form-group">
                    <label for="password"><strong>Password:*</strong></label>
                    <input id="password" type="password" class="form-control" id="InputPassword1" placeholder="Password">
                </div>
                <div class="col form-group">
                    <label for="confirmPassword"><strong>Confirm Password:*</strong></label>
                    <input id="confirmPassword" type="password" class="form-control" placeholder="Password">
                </div>
            </div>
            <div class="row">
                <span class="display-inline"><input type="checkbox" id="t&c" ><small>By creating your account, you agree to the <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ">Terms of Service</a> and <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ">Privacy Policy</a></small></span>
            </div>
            <div class="form-group btns-group">
                <a href="#" class="btn btn-primary btn-next" id="next">Next</a>
            </div>
        </div>

        <!-- Step 2 -->
        <div class="form-step" data-step="2">
            <!-- Step 2 Fields -->
            <h1 class="display m">Thanks for registering with us!</h1>
            <p class="display">Let's get started on your journey to fitness by filling in the required information below. It will allow us to curate a personalized plan for you!</p>
            <div class="form-group row  " style="margin-bottom: 2%;">
                <label for="gender"><strong>Gender:</strong></label>
                <div class="col-md-4">
                    <input type="radio" id="male" class="gender" value="male" name="gender" checked> Male
                </div>
                <div class="col-md-4">
                    <input type="radio" id="female" class="gender" value="female" name="gender"> Female
                </div>
                <div class="col-md-4">
                    <input type="radio" id="other" class="gender" value="other" name="gender"> Other
                </div>
            </div>

            <div class="form-group row" style="margin-bottom: 2%;">
                <label for="exerciseDays"><strong>How many days per week do you currently exercise?</strong></label>
                <input type="range" class="form-range" name="exerciseDaysCount" id="exerciseDays" min="0" max="7" required>
                <div class="output-container">
                    <output for="exerciseDays" class="output">0 days</output>
                    <output for="exerciseDays" class="output">1 days</output>
                    <output for="exerciseDays" class="output">2 days</output>
                    <output for="exerciseDays" class="output">3 days</output>
                    <output for="exerciseDays" class="output">4 days</output>
                    <output for="exerciseDays" class="output">5 days</output>
                    <output for="exerciseDays" class="output">6 days</output>
                    <output for="exerciseDays" class="output">7 days</output>
                </div>
            </div>
            <div class="form-group row " style="margin-bottom: 2%;">
                <label for="fitnessLevel"><strong>How would you rate your current fitness level? (Beginner, Intermediate, Advanced)</strong></label>
                <select class="form-control" name="fitnessLevel" id="fitnessLevel">
                    <option value="beginner">Beginner</option>
                    <option value="intermediate">Intermediate</option>
                    <option value="advanced">Advanced</option>
                </select>
            </div>
            
            <div class="form-group btns-group">
                <a href="#" class="btn btn-outline-primary btn-prev">Previous</a>
                <a href="#" class="btn btn-primary btn-next">Next</a>
            </div>
        </div>

        <!-- Step 3 -->
     
        <div class="form-step" data-step="3">
            <!-- Step 3 Fields -->
            <h1>Lifestyle</h1>
            <div class="form-group row" style="margin-bottom: 2%;">
                <label for="allergies"><strong>Do you have any known allergies? If yes, please provide details.</strong></label>
                <textarea class="form-control" name="allergies" id="allergies">None</textarea>
            </div>
            <div class="form-group row " style="margin-bottom: 2%;">
                <label for="dietaryRestrictions"><strong>Do you have any dietary restrictions or preferences? If yes, please provide details.</strong></label>
                <textarea class="form-control" name="dietaryRestrictions" id="dietaryRestrictions" value="">None</textarea>
            </div>
            
            <div class="form-group btns-group">
                <a href="#" class="btn btn-outline-primary btn-prev">Previous</a>
                <a href="#" class="btn btn-primary btn-next">Next</a>
            </div>
        </div>


        <!-- Step 4 -->
        <div class="form-step" data-step="4">
            <!-- Step 4 Fields -->
            <h1>Training Preferences</h1>
            
            
            <div class="form-group row" style="margin-bottom: 2%;">
                <label for="chosenWorkoutSessions"><strong>Select the number of sessions you want to complete in the next week:*</strong></label>
                <input type="number" min="1" max="7" class="form-control" name="chosenWorkoutSessions" id="chosenWorkoutSessions" value="1">
            </div>
            <div class="form-group row " style="margin-bottom: 2%;">
                <label for="trainingLocation"><strong>What is your preferred training location? (Gym, Outdoors, Home, Virtual)</strong></label>
                <input type="text" class="form-control" name="trainingLocation" id="trainingLocation" value="Anywhere">
            </div>

            <div class="form-group row " style="margin-bottom: 2%;">
                <label for="trainerInterest"><strong>Are you interested in working with a personal trainer or joining group classes?</strong></label>
                <select class="form-control" name="trainerInterest" id="trainerInterest">
                    <option value="personalTrainer">Personal Trainer</option>
                    <option value="groupClasses">Group Classes</option>
                    <option value="selfWorkout">By Myself</option>
                </select>
            </div>

            <div class="form-group btns-group" style="margin-bottom: 2%;"> 
                <a href="#" class="btn btn-outline-primary btn-prev">Previous</a>
                <button type="submit" class="btn btn-success">Submit</button>
            </div>
            <p id="error-header"></p>
            <ul id="problems"></ul>
        </div>
    </form>
    <script>
        const prevBtns = document.querySelectorAll(".btn-prev"); 
        const nextBtns = document.querySelectorAll(".btn-next");
        const progress = document.getElementById("progress"); 
        const formSteps = document.querySelectorAll(".form-step"); 
        const progressSteps = document.querySelectorAll(".progress-step"); 

        let formStepsNum = 0; 

        // Iterate through nextBtns collection onclick
        nextBtns.forEach((btn) => {
            btn.addEventListener("click", () => {
            formStepsNum++;
            updateFormSteps();
            updateProgressbar();
            });
        });

        //Iterate through prevBtns collection onclick
        prevBtns.forEach((btn) => {
            btn.addEventListener("click", () => {
                formStepsNum--; 
                updateFormSteps(); 
                updateProgressbar(); 
            });
        });

        //Helper fnc 1 - removes and applies to next step 
        function updateFormSteps(){
            formSteps.forEach((formStep) => {
                formStep.classList.contains("form-step-active") && formStep.classList.remove("form-step-active");
            });
            formSteps[formStepsNum].classList.add("form-step-active");
        }

        //Helper fnc 2
        function updateProgressbar() {
            progressSteps.forEach((progressStep, index) => {
                if (index < formStepsNum + 1){
                    progressStep.classList.add("progress-step-active");
                } else {
                    progressStep.classList.remove("progress-step-active");
                }
                });
                const progressActive = document.querySelectorAll(".progress-step-active");

                progress.style.width = ((progressActive.length - 1) / (progressSteps.length - 1)) * 100 + "%";
        }
       
        
        
         
    </script>
    <script type="module">
        
        
    
        
            
            document.getElementById('registrationForm').addEventListener('submit', submitForm);
            
            function submitForm(e) {
            e.preventDefault();
            if (getElementVal('name') == "" || getElementVal('emailId') == "" || getElementVal('password') == "" || getElementVal('confirmPassword') == "" || getElementVal('password').length < 8 || getElementVal('password') != getElementVal('confirmPassword') || terms == false) {
                var issues = []
                var output = ""
                if (getElementVal('name') == "") {
                    issues.push("Please enter your name")
                }
                if (getElementVal("emailId") == "") {
                    issues.push("Please enter your email")
                }
                if (getElementVal('password') == "" ) {
                    issues.push("Please enter your password")
                }
                if (getElementVal('confirmPassword') == "") {
                    issues.push("Please confirm your password")
                }
                if (getElementVal('password') != getElementVal('confirmPassword')) {
                    issues.push("Passwords do not match")
                }
                if (getElementVal('password').length < 8) {
                    issues.push("Password must be minimum 8 characters")
                }
                if (terms == false) {
                    issues.push("Please agree to the terms and conditions")
                }
                for (var element of issues) {
                    output += "<li>"+ element + "</li>"
                }
                document.getElementById("error-header").innerText = "Errors:"
                document.getElementById('problems').innerHTML = output
            } else {
            document.getElementById("error-header").innerText = ""
            document.getElementById('problems').innerHTML = ""

            const name = getElementVal('name');
            const emailId = getElementVal('emailId');
            const birthdate = getElementVal('birthdate');
            const phoneNumber = getElementVal('phoneNumber');
            const password = getElementVal('password');
            const gender = document.getElementsByName('gender');
            const exerciseDaysCount = getElementVal('exerciseDays');
            const fitnessLevel = getElementVal('fitnessLevel');
            
            const allergies = getElementVal('allergies');
            const dietaryRestrictions = getElementVal('dietaryRestrictions');
            
            
            const trainingLocation = getElementVal('trainingLocation');
            const trainerInterest = getElementVal('trainerInterest');
            const bookmarks = {"meals":[1], "workouts":[1]};
            const chosenWorkoutSessions = getElementVal("chosenWorkoutSessions");
            const completedWorkoutSessions = 0

            createUserWithEmailAndPassword(auth, emailId, password)
                    .then((userCredential) => {
                    // Signed up 
                    const user = userCredential.user;
                    var id = user.uid
                    function writeUserData(id, name, chosenWorkoutSessions, completedWorkoutSessions, bookmarks, birthdate, phoneNumber, gender, exerciseDaysCount, fitnessLevel,  allergies, dietaryRestrictions,  trainerInterest, trainingLocation) {
                    const db = getDatabase();
                    set(ref(db, 'userData/' + id), {
                        username: name,
                        chosensessions:chosenWorkoutSessions,
                        completedsessions: completedWorkoutSessions,
                        favourites: bookmarks ,
                        birthday: birthdate,
                        phone: phoneNumber,
                        gender: gender,
                        exerciseDaysCounter: exerciseDaysCount,
                        fitnesslevel: fitnessLevel,
                        
                        allergies: allergies,
                        diet: dietaryRestrictions,
                     
                       
                        trainerInterest: trainerInterest,
                        trainingLocation : trainingLocation
                    });
                    }
                    writeUserData(id, name, chosenWorkoutSessions, completedWorkoutSessions, bookmarks, birthdate, phoneNumber, gender, exerciseDaysCount, fitnessLevel,  allergies, dietaryRestrictions,  trainerInterest, trainingLocation)
                    //enable alert
                    document.querySelector(".alert").style.display = "block";
                    
                    //remove the alert
                    setTimeout(() => {
                    document.querySelector(".alert").style.display = "none";
                    }, 3000);
                    
                    //reset the form
                    document.getElementById("registrationForm").reset();
                    location.replace("login.html")
                    console.log(user)
                    console.log("Success!")
                    // ...
                    })
                    .catch((error) => {
                        const errorCode = error.code;
                        const errorMessage = error.message;
                        console.log(errorMessage)
                        document.getElementById("registrationForm").reset();
                        alert("Please try again!")
                    });
            
            
            
            
                }
            }
            
            
            
            function getElementVal(id) {
            return document.getElementById(id).value;
            }
            
            function getSelectedOptions(selectId) {
                const selectElement = document.getElementById(selectId);
                const selectedOptions = [];
                for (let i = 0; i < selectElement.options.length; i++) {
                    const option = selectElement.options[i];
                    if (option.selected) {
                    selectedOptions.push(option.value);
                    }
                }
                return selectedOptions;
                }
      
    </script>

    
</body>
</html>
