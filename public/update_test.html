<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/register.css">
    <!-- <script src="js/register.js" defer></script> -->
    <title>Weekly Check-in</title>

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" 
    rel="stylesheet" 
    integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" 
    crossorigin="anonymous">
    <style>
       .progress-step {
        text-align: center;
       }
       #next {
        margin-top: 7%;
       }
       #problems, #error-header {
        color: red;
       }
    </style>
</head>
<body>
    <div id="intro" class="title">
        <h2>Hello Rachel! Here's your Weekly Check-In</h2>
    </div>

    <form action="update_V2.html" class="form container" id="registrationForm">

        <!-- Progress bar -->
        <div class="progressbar" >
            <div class="progress " id="progress"></div>
            <div class="progress-step progress-step-active" data-title="Recap"></div>
            <div class="progress-step" data-title="Progress Update"></div>
            <div class="progress-step" data-title="Goal Settings"></div>
            <div class="progress-step" data-title="Recommendation"></div>
        </div>
   
        <!-- Steps -->
        <div class="form-step form-step-active" data-step="1">
            <!-- Step 1 Fields -->
            <h2 class="display mb-3">Let's complete your Weekly Check-In!</h2> <br><br>
            
            <div class="row input-group">
                <div class="col-sm-12 form-group">
                    <label for="name"><strong>How many workouts did you complete this week?</strong></label>
                    <input type="range" class="form-range" name="workoutsCount" id="workouts_thisWeek" min="0" max="5" required>
                    <div class="output-container">
                        <output for="exerciseDays" class="output">0 workout</output>
                        <output for="exerciseDays" class="output">1 workouts</output>
                        <output for="exerciseDays" class="output">2 workouts</output>
                        <output for="exerciseDays" class="output">3 workouts</output>
                        <output for="exerciseDays" class="output">4 workouts</output>
                        <output for="exerciseDays" class="output">5 workouts</output>
                    </div>
                </div>
            </div>

            <div class="row input-group">
                <div class="col-sm-12 form-group">
                    <label for="name"><strong>How many meals did you make this week?</strong></label>
                    <input type="range" class="form-range" name="mealsCount" id="meals_thisWeek" min="0" max="5" required>
                    <div class="output-container">
                        <output for="exerciseDays" class="output">0 meal</output>
                        <output for="exerciseDays" class="output">1 meals</output>
                        <output for="exerciseDays" class="output">2 meals</output>
                        <output for="exerciseDays" class="output">3 meals</output>
                        <output for="exerciseDays" class="output">4 meals</output>
                        <output for="exerciseDays" class="output">5 meals</output>
                    </div>
                </div>
            </div>

            <div class="form-group btns-group">
                <a href="#" class="btn btn-primary btn-next" id="next">Next</a>
            </div>
        </div>

        <!-- Step 2 -->
        <div class="form-step" data-step="2">
            <!-- Step 2 Fields -->
            <h2 class="display m">Let's see your Progress for Last Week!</h2>

            <div class="form-group row" style="margin-bottom: 2%;">
                <label for="progress"><strong>Here's your progress for last week!</strong></label>
            </div>

            <div class="form-group row" style="margin-bottom: 2%;">
                <label for="overall_progress"><strong>Here's your overall progress!</strong></label>
            </div>
            
            <div class="form-group btns-group">
                <a href="#" class="btn btn-outline-primary btn-prev">Previous</a>
                <a href="#" class="btn btn-primary btn-next">Next</a>
            </div>
        </div>

        <!-- Step 3 -->
        <div class="form-step" data-step="3">
            <!-- Step 3 Fields -->
            <h2 class="display m">Let's set your Goals for Next Week!</h2>

            <div class="form-group row" style="margin-bottom: 2%;">
                <label for="goals"><strong>How many workouts would you like to complete Next Week?</strong></label>
                <input type="range" class="form-range" name="workoutsCount" id="workouts_nextWeek" min="0" max="5" required>
                    <div class="output-container">
                        <output for="exerciseDays" class="output">0 workout</output>
                        <output for="exerciseDays" class="output">1 workouts</output>
                        <output for="exerciseDays" class="output">2 workouts</output>
                        <output for="exerciseDays" class="output">3 workouts</output>
                        <output for="exerciseDays" class="output">4 workouts</output>
                        <output for="exerciseDays" class="output">5 workouts</output>
                    </div>
            </div>

            <div class="form-group row" style="margin-bottom: 2%;">
                <label for="goals"><strong>How many meals would you like to prepare Next Week?</strong></label>
                <input type="range" class="form-range" name="mealsCount" id="meals_nextWeek" min="0" max="5" required>
                    <div class="output-container">
                        <output for="exerciseDays" class="output">0 meal</output>
                        <output for="exerciseDays" class="output">1 meals</output>
                        <output for="exerciseDays" class="output">2 meals</output>
                        <output for="exerciseDays" class="output">3 meals</output>
                        <output for="exerciseDays" class="output">4 meals</output>
                        <output for="exerciseDays" class="output">5 meals</output>
                    </div>
            </div>
            
            <div class="form-group btns-group">
                <a href="#" class="btn btn-outline-primary btn-prev">Previous</a>
                <a href="#" class="btn btn-primary btn-next">Next</a>
            </div>
        </div>


        <!-- Step 4 -->
        <div class="form-step" data-step="4">
            <!-- Step 4 Fields -->
            <h2 class="display m">Here's your recommendations!</h2>
            
            <div class="form-group row" style="margin-bottom: 2%;">
                <label for="recommendations"><strong>Your personalised recommendations:</strong></label>
            </div>

            <div class="form-group btns-group" style="margin-bottom: 2%;"> 
                <a href="#" class="btn btn-outline-primary btn-prev" id="previous">Previous</a>
                <button type="submit" class="btn btn-success" id="submit">Done</button>
                <button type="btn" class="btn btn-success" style="display: none;" id="gotologin">Go to login page</button>
            </div>
            <p id="error-header"></p>
            <ul id="problems"></ul>
        </div>
    </form>


    <script>
        const prevBtns = document.querySelectorAll(".btn-prev"); 
        const nextBtns = document.querySelectorAll(".btn-next");
        const progress = document.getElementById("progress"); 
        const formSteps = document.querySelectorAll(".form-step"); 
        const progressSteps = document.querySelectorAll(".progress-step"); 

        let formStepsNum = 0; 

        // Iterate through nextBtns collection onclick
        nextBtns.forEach((btn) => {
            btn.addEventListener("click", () => {
            formStepsNum++;
            updateFormSteps();
            updateProgressbar();
            });
        });

        //Iterate through prevBtns collection onclick
        prevBtns.forEach((btn) => {
            btn.addEventListener("click", () => {
                formStepsNum--; 
                updateFormSteps(); 
                updateProgressbar(); 
            });
        });

        //Helper fnc 1 - removes and applies to next step 
        function updateFormSteps(){
            formSteps.forEach((formStep) => {
                formStep.classList.contains("form-step-active") && formStep.classList.remove("form-step-active");
            });
            formSteps[formStepsNum].classList.add("form-step-active");
        }

        //Helper fnc 2
        function updateProgressbar() {
            progressSteps.forEach((progressStep, index) => {
                if (index < formStepsNum + 1){
                    progressStep.classList.add("progress-step-active");
                } else {
                    progressStep.classList.remove("progress-step-active");
                }
                });
                const progressActive = document.querySelectorAll(".progress-step-active");

                progress.style.width = ((progressActive.length - 1) / (progressSteps.length - 1)) * 100 + "%";
        }
         
    </script>


 
    <script type="module">
	    // Import the functions you need from the SDKs you need
		import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";
		import { getDatabase, ref, child, get } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyAuv9pHvIhlo_wNj4tdkzNanWoGtQ-5-t4",
          authDomain: "is216-g2.firebaseapp.com",
          databaseURL: "https://is216-g2-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "is216-g2",
          storageBucket: "is216-g2.appspot.com",
          messagingSenderId: "426453655797",
          appId: "1:426453655797:web:26878838329ce6c02365bc",
          measurementId: "G-HYZ4GSYP9Y"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
		const database = getDatabase(app)

        function submitForm(e){
            e.preventDefault();

            const prevWorkouts = getElementVal();
            const prevWorkoutsCompleted = getElementVal();
            const prevMeals = getElementVal();
            const prevMealsCompleted = getElementVal();

            const nextWorkouts = getElementVal();
            const nextMeals = getElementVal()

            
            const user = userCredential.user;
            var id = user.uid
                    function writeUserData(id, name, chosenWorkoutSessions, completedWorkoutSessions) {
                    const db = getDatabase();
                    set(ref(db, 'userData/' + id), {
                        username: name,
                        chosensessions:chosenWorkoutSessions,
                        completedsessions: completedWorkoutSessions,
                
                    });
                    }
            writeUserData(id, name, chosenWorkoutSessions, completedWorkoutSessions)

        }

</script>

    
</body>
</html>
