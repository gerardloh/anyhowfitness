
<!--Website: wwww.codingdung.com-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Page</title>
    <link rel="stylesheet" href="css/profilestyle.css">

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous"> 

<style>
    body {
    background-image: url("images/bgprofile.png");
    background-size: cover; /* Scale the image to cover the entire viewport */
    margin-top: 20px;
}
img {
    max-width: 100px;
}
</style>
</head>

<body>
<div class="container light-style flex-grow-1 container-p-y">
        
        <h4 style="color: aliceblue;" class="font-weight-bold py-3 mb-4">
            My Profile Page
        </h4>

<div class="card overflow-hidden">

<div class="row no-gutters row-bordered row-border-light">

<!-- =========================
        Left-side Bar   
============================== -->
<div class="col-md-3 pt-0">
    <div class="list-group list-group-flush account-settings-links">
        <a class="list-group-item list-group-item-action active" data-toggle="list"
            href="#account-general">General</a>
        <a class="list-group-item list-group-item-action" data-toggle="list"
            href="#account-change-password">Change password</a>
        <a class="list-group-item list-group-item-action" data-toggle="list"
            href="#fitness-details">Fitness details</a>
        <a class="list-group-item list-group-item-action" data-toggle="list"
            href="#health-history">Health history</a>
        <a class="list-group-item list-group-item-action" data-toggle="list"
            href="#lifestyle-nutrition">Lifestyle & Nutrition</a>
        <a class="list-group-item list-group-item-action" data-toggle="list"
            href="#training-preferences">Training Preferences</a>
        <a class="list-group-item list-group-item-action" data-toggle="list"
            href="#account-notifications">Notifications</a>
    </div>
</div>

<!-- ============================== -->

                
<div class="col-md-9">
    <div class="tab-content">


<!-- =========================
            General 
============================== -->
<div class="tab-pane fade active show" id="account-general">
    <div class="card-body media align-items-center">
        <img src="images/image.jpg" alt
            class="d-block ui-w-80" id="profilepic">
        <div class="media-body ml-4">
            <label class="btn btn-outline-primary">
                Upload new photo
                <input type="file" class="account-settings-fileinput" id="imagefile">
            </label> &nbsp; &nbsp;
            <!-- <button type="button" class="btn btn-default md-btn-flat">Reset</button> -->
            <div class=" small mt-1">Allowed JPG, GIF or PNG. Max size of 800K</div>
        </div>
    </div>
    <hr class="border-light m-0">

    <div class="card-body">

        <div style="display: flex;">
            <div style="flex: 1;">
                <div class="form-group">
                    <label class="form-label">Username:</label>
                    <input type="text" class="form-control" id="username" >
                </div>
            </div>
        </div>

        <div class="form-group">
            <label class="form-label">Email address:</label>
            <input type="text" class="form-control mb-1"  id="email">
            <!-- <div class="alert alert-warning mt-3">
                Your email is not confirmed. Please check your inbox.<br>
                <a href="javascript:void(0)">Resend confirmation</a>
            </div> -->
        </div>
        <!-- <div class="form-group">
            <label class="form-label">Company</label>
            <input type="text" class="form-control" value="Company Ltd.">
        </div> -->

        <div class="form-group">
            <label class="form-label">Date of Birth:</label>
            <input type="date" class="form-control"  id="dob">
        </div>

        <div class="form-group">
            <label class="form-label">Phone Number:</label>
            <input type="tel" class="form-control" id="phone">
        </div>

    </div>
</div>


<!-- =========================
         Change Password
============================== -->
<div class="tab-pane fade" id="account-change-password">
    <div class="card-body pb-2">
        <div class="form-group">
            <label class="form-label">Current password:</label>
            <input type="password" class="form-control" id="curr-pass">
        </div>
        <div class="form-group">
            <label class="form-label">New password:</label>
            <input type="password" class="form-control" id="new-pass">
        </div>
        <div class="form-group">
            <label class="form-label">Repeat new password:</label>
            <input type="password" class="form-control" id="cfm-pass">
        </div>
    </div>
</div>


<!-- =========================
        Fitness Details
============================== -->
<div class="tab-pane fade" id="fitness-details">

<br>

<label for="exerciseDays">How many days per week do you currently exercise?</label>
<select class="form-select" aria-label="Default select example" id="workingdays">
    <option value="0" id="0">0</option>
    <option value="1" id="1">1</option>
    <option value="2" id="2">2</option>
    <option value="3" id="3">3</option>
    <option value="4" id="4">4</option>
    <option value="5" id="5">5</option>
    <option value="6" id="6">6</option>
    <option value="7" id="7">7</option>
</select>
   
               
<br>
<label>How would you rate your current fitness level? (Beginner, Intermediate, Advanced)</label>
<select class="form-select" aria-label="Default select example" id="fitlevel">
    <option value="beginner" id="beginner">Beginner</option>
    <option value="intermediate" id="intermediate">Intermediate</option>
    <option value="advanced" id="advanced">Advanced</option>
</select>
    
                
    <hr class="border-light m-0">
</div>


<!-- =========================
        Health History
============================== -->
<div class="tab-pane fade" id="health-history">
    <div class="form-group row m-3 p-2">
        <label>Do you have any known allergies? If yes, please provide details.</label>
        <textarea class="form-control" name="allergies" id="allergies"></textarea>
    </div>
</div>


<!-- =========================
    Lifestyle & Nutrition
============================== -->
<div class="tab-pane fade" id="lifestyle-nutrition">
    <br>

    <div class="form-group row m-3 p-2">
        <label>Do you have any dietary restrictions or preferences? If yes, please provide details.</label>
        <textarea class="form-control" name="restrictions" id="restrictions"></textarea>
    </div>

</div>


<!-- =========================
    Training Preferences
============================== -->
<div class="tab-pane fade" id="training-preferences">

    <div class="form-group row m-3 p-2">
        <label>Select your preferred training location:</label>
        <input class="form-control " type="text" name="location" id="location">
        
    </div>

    <label >Are you interested in working with a personal trainer or joining group classes?</label>
    <select class="form-select" aria-label="Default select example" id="trainerpref">
        <option value="personalTrainer" id="personalTrainer">Personal Trainer</option>
        <option value="groupClasses" id="groupClasses" >Group Classes</option>
        <option value="selfWorkout" id="selfWorkout">By Yourself</option>
    </select>
                
    <br>

        <hr class="border-light m-0">
    </div>

<!-- =========================
        Notifications
============================== -->
                        <div class="tab-pane fade" id="account-notifications">
                            <div class="card-body pb-2">
                                <h6 class="mb-4">Activity</h6>
                                <div class="form-group">
                                    <label class="switcher">
                                        <input type="checkbox" class="switcher-input" checked>
                                        <span class="switcher-indicator">
                                            <span class="switcher-yes"></span>
                                            <span class="switcher-no"></span>
                                        </span>
                                        <span class="switcher-label">Notify me when someone replies me</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="switcher">
                                        <input type="checkbox" class="switcher-input" checked>
                                        <span class="switcher-indicator">
                                            <span class="switcher-yes"></span>
                                            <span class="switcher-no"></span>
                                        </span>
                                        <span class="switcher-label">Notify me when someone answers on my forum
                                            thread</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="switcher">
                                        <input type="checkbox" class="switcher-input">
                                        <span class="switcher-indicator">
                                            <span class="switcher-yes"></span>
                                            <span class="switcher-no"></span>
                                        </span>
                                        <span class="switcher-label">Notify me when someone follows me</span>
                                    </label>
                                </div>
                            </div>
                            <hr class="border-light m-0">
                            <div class="card-body pb-2">
                                <h6 class="mb-4">Application</h6>
                                <div class="form-group">
                                    <label class="switcher">
                                        <input type="checkbox" class="switcher-input" checked>
                                        <span class="switcher-indicator">
                                            <span class="switcher-yes"></span>
                                            <span class="switcher-no"></span>
                                        </span>
                                        <span class="switcher-label">Weekly Update</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="switcher">
                                        <input type="checkbox" class="switcher-input">
                                        <span class="switcher-indicator">
                                            <span class="switcher-yes"></span>
                                            <span class="switcher-no"></span>
                                        </span>
                                        <span class="switcher-label">Weekly product updates</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="switcher">
                                        <input type="checkbox" class="switcher-input" checked>
                                        <span class="switcher-indicator">
                                            <span class="switcher-yes"></span>
                                            <span class="switcher-no"></span>
                                        </span>
                                        <span class="switcher-label">Weekly blog digest</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        
        <div class="text-right mt-3">
            <button type="button" class="btn btn-primary" id="save">Save changes</button>&nbsp;
            <button type="button" class="btn btn-default" style="color: aliceblue; background: grey;" id="cancel">Cancel</button>
            <ul id="epicfails"></ul>
            <ul id="suck"></ul>
        </div>

    </div>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, updateEmail, updatePassword } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";
        import { getDatabase, ref, child, get, update} from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";
        import {getStorage, uploadBytes, getDownloadURL} from "https://www.gstatic.com/firebasejs/10.5.0/firebase-storage.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyAuv9pHvIhlo_wNj4tdkzNanWoGtQ-5-t4",
          authDomain: "is216-g2.firebaseapp.com",
          databaseURL: "https://is216-g2-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "is216-g2",
          storageBucket: "is216-g2.appspot.com",
          messagingSenderId: "426453655797",
          appId: "1:426453655797:web:26878838329ce6c02365bc",
          measurementId: "G-HYZ4GSYP9Y"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
	    const database = getDatabase(app)
        const storage = getStorage();


        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in, see docs for a list of available properties
                // https://firebase.google.com/docs/reference/js/auth.user
                const uid = user.uid;
				const dbRef = ref(getDatabase());
				var link = "userData/" + uid

                /*getDownloadURL(ref(storage, uid))
                .then((url) => {
                    // `url` is the download URL for 'images/stars.jpg'

                    // Or inserted into an <img> element
                    const img = document.getElementById('profilepic');
                    img.setAttribute('src', url);
                })
                .catch((error) => {
                    // Handle any errors
                    console.log(error)
                }); */

				get(child(dbRef, link)).then((snapshot) => {
				if (snapshot.exists()) {
					document.getElementById("username").value = snapshot.val().username
                    document.getElementById("email").value = user.email 
                    document.getElementById("dob").value = snapshot.val().birthday
                    document.getElementById("phone").value = snapshot.val().phone
                    document.getElementById("allergies").value = snapshot.val().allergies
                    document.getElementById("restrictions").value = snapshot.val().diet
                    document.getElementById("location").value = snapshot.val().trainingLocation
                    var counter = snapshot.val().exerciseDaysCounter
                    document.getElementById(counter).setAttribute('selected', 'selected')
                    var flevel = snapshot.val().fitnesslevel
                    document.getElementById(flevel).setAttribute('selected','selected')
                    var usertrainingpref = snapshot.val().trainerInterest
                    document.getElementById(usertrainingpref).setAttribute('selected', 'selected')
					console.log(snapshot.val());

                    document.getElementById("save").addEventListener("click", function () {
                        var file = document.getElementById("imagefile").files[0]
                        uploadBytes(ref(storage, uid), file).then((snapshot) => {
                            console.log('Uploaded a blob or file!');
                            });

                        var successmsg = ""
                        var curr_pass = document.getElementById("curr-pass").value
                        var new_pass = document.getElementById("new-pass").value
                        var cfm_pass = document.getElementById("cfm-pass").value
                        if (curr_pass != "" || new_pass != "" || cfm_pass != "") {
                            if(new_pass != cfm_pass || new_pass.length <8 || new_pass == "" || curr_pass == "" || cfm_pass =="") {
                            var epicfails = ""
                            if (new_pass != cfm_pass) {
                                epicfails += "<li>Your password confirmation does not match with your new password!</li>"
                            }
                            if (new_pass.length <8) {
                                epicfails += "<li>New password must be at least 8 characters long!</li>"
                            }
                            if (new_pass == "") {
                                epicfails += "<li>New password cannot be empty!</li>"
                            }
                            if (cur_pass == "") {
                                epicfails += "<li>Current password cannot be empty!</li>"
                            }
                            if (cfm_pass == "") {
                                epicfails += "<li>Confirm password cannot be empty!</li>"
                            }
                            document.getElementById("epicfails").innerHTML = epicfails
                            } else {
                                updatePassword(user, new_pass).then(() => {
                                // Update successful.
                                successmsg += "<li>Password update successful!</li>"

                                }).catch((error) => {
                                // An error ocurred
                                console.log(error)
                                // ...
                                });
                            }
                        }
                        var new_email = document.getElementById("email").value
                        if (new_email != "") {
                            updateEmail(auth.currentUser, new_email).then(() => {
                            // Email updated!
                            successmsg += "<li>Email updated!</li>"
                            // ...
                            }).catch((error) => {
                            // An error occurred
                            console.log(error)
                            // ...
                            });
                        }

                        var uname = document.getElementById("username").value
                        var link2 = link + "/username"
                        var updates = {}
                        updates[link + "/username"] = uname

                        var dob = document.getElementById("dob").value
                        updates[link + "/birthday"] = dob

                        var fone = document.getElementById("phone").value
                        updates[link + "/phone"] = fone

                        var exDays = document.getElementById("workingdays").value
                        updates[link + "/exerciseDaysCounter"] = exDays

                        var fitlevel = document.getElementById("fitlevel").value
                        updates[link + "/fitnesslevel"] = fitlevel

                        var allergies = document.getElementById("allergies").value
                        updates[link + "/allergies"] = allergies

                        var restrictions = document.getElementById("restrictions").value
                        updates[link + "/diet"] = restrictions

                        var location = document.getElementById("location").value
                        updates[link + "/trainingLocation"] = location

                        var trainerpref = document.getElementById("trainerpref").value
                        updates[link + "/trainerInterest"] = trainerpref
                        
                        successmsg += "<li>Successfully updated!</li>"
                        update(dbRef, updates)
                        document.getElementById("suck").innerHTML = successmsg
                    })

                    document.getElementById("cancel").addEventListener("click", function () {
                        window.location.href = "user.html"
                    })
				} else {
					console.log("No data available");
				}
				}).catch((error) => {
				console.error(error);
				});
                // ...
            } else {
                // User is signed out
                // ...
                location.replace("index.html")
                console.log("wrong")
            }
            });

    </script>
    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript">

    </script>
</body>

</html>